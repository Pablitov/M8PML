<html>

<head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Data Science - Module 8 PML - Project Assignment</title>
</head>

<body>

<H1> 0. Executive summary </H1>
<p>
This is an R HTML document. When you click the <b>Knit HTML</b> button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
Start loading the "training"" and "test"" datasets for this project: </p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># Load libraries</span>
<span class="hl kwd">library</span><span class="hl std">(ggplot2);</span> <span class="hl kwd">library</span><span class="hl std">(htmltools);</span> <span class="hl kwd">library</span><span class="hl std">(caret);</span> <span class="hl kwd">library</span><span class="hl std">(randomForest);</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: lattice
</pre></div>
<div class="message"><pre class="knitr r">## randomForest 4.6-12
</pre></div>
<div class="message"><pre class="knitr r">## Type rfNews() to see new features/changes/bug fixes.
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'randomForest'
</pre></div>
<div class="message"><pre class="knitr r">## The following object is masked from 'package:ggplot2':
## 
##     margin
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(forecast);</span> <span class="hl kwd">library</span><span class="hl std">(caret);</span> <span class="hl kwd">library</span><span class="hl std">(rpart)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: zoo
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'zoo'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: timeDate
</pre></div>
<div class="message"><pre class="knitr r">## This is forecast 7.3
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">ini_seed</span> <span class="hl kwb">=</span> <span class="hl num">12345</span><span class="hl std">;</span> <span class="hl kwd">set.seed</span><span class="hl std">(ini_seed)</span>                  <span class="hl com"># Set seed for reproducibility</span>
<span class="hl kwd">setwd</span><span class="hl std">(</span><span class="hl str">&quot;C:/Users/MNP/Documents/R/Module 8 PML&quot;</span><span class="hl std">)</span>
<span class="hl std">urlTR</span><span class="hl kwb">&lt;-</span><span class="hl str">&quot;https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv&quot;</span>
<span class="hl std">urlTS</span><span class="hl kwb">&lt;-</span> <span class="hl str">&quot;https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv&quot;</span>
<span class="hl com">#download.file(urlTR,&quot;pml-training.csv&quot;)</span>
<span class="hl com">#download.file(urlTS,&quot;pml-testing.csv&quot;)</span>
<span class="hl std">TR</span><span class="hl kwb">&lt;-</span><span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;pml-training.csv&quot;</span><span class="hl std">)</span> <span class="hl com">## 1</span>
<span class="hl std">VAL</span><span class="hl kwb">&lt;-</span><span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;pml-testing.csv&quot;</span><span class="hl std">)</span>
<span class="hl std">varnames</span><span class="hl kwb">&lt;-</span><span class="hl kwd">names</span><span class="hl std">(TR); nvars</span><span class="hl kwb">&lt;-</span><span class="hl kwd">dim</span><span class="hl std">(TR)[</span><span class="hl num">2</span><span class="hl std">]</span>
</pre></div>
</div></div>

<H1> 1. Cleaning the data sets </H1>

<p> 1.2. Remove NAs </p>
<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(TR));</span> <span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(VAL))</span> <span class="hl com"># This gives the number of NAs on each dataset</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 1287472
</pre></div>
<div class="output"><pre class="knitr r">## [1] 2000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's see the % of NAs in each column</span>
<span class="hl std">naTR</span><span class="hl kwb">&lt;-</span><span class="hl kwd">apply</span><span class="hl std">(TR,</span><span class="hl num">1</span><span class="hl std">,is.na);  nnaTR</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">apply</span><span class="hl std">(naTR,</span><span class="hl num">1</span><span class="hl std">,sum)</span><span class="hl opt">/</span><span class="hl kwd">dim</span><span class="hl std">(naTR)[</span><span class="hl num">2</span><span class="hl std">])</span>
<span class="hl std">naVAL</span><span class="hl kwb">&lt;-</span><span class="hl kwd">apply</span><span class="hl std">(VAL,</span><span class="hl num">1</span><span class="hl std">,is.na); nnaVAL</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">apply</span><span class="hl std">(naVAL,</span><span class="hl num">1</span><span class="hl std">,sum)</span><span class="hl opt">/</span><span class="hl kwd">dim</span><span class="hl std">(naVAL)[</span><span class="hl num">2</span><span class="hl std">])</span>

<span class="hl com"># we will only consider variables that have a percentage of NAs is greater than 50% in both datasets.</span>
<span class="hl std">goodVAL</span><span class="hl kwb">&lt;-</span><span class="hl std">nnaVAL</span><span class="hl opt">&lt;</span><span class="hl num">0.5</span><span class="hl std">; goodTR</span><span class="hl kwb">&lt;-</span><span class="hl std">nnaTR</span><span class="hl opt">&lt;</span><span class="hl num">0.5</span><span class="hl std">; goodboth</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.logical</span><span class="hl std">(goodVAL</span><span class="hl opt">*</span><span class="hl std">goodTR)</span>

<span class="hl com"># We can verify that when NAs are present in a variable, it is really abundant (97.93%), so we'll remove directly those variables</span>
<span class="hl std">goodboth</span><span class="hl kwb">&lt;-</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">length</span><span class="hl std">(goodboth))[goodboth]</span>

<span class="hl com"># Now we can filter out variables from the two datasets and check the number of NAs is zero</span>
<span class="hl std">TR</span><span class="hl kwb">&lt;-</span><span class="hl std">TR[,goodboth];</span> <span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(TR))</span> <span class="hl com">##2</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">VAL</span><span class="hl kwb">&lt;-</span><span class="hl std">VAL[,goodboth];</span> <span class="hl kwd">sum</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(VAL))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's take a look at the varnames that are ok:</span>
<span class="hl std">varnames[goodboth]</span>
</pre></div>
<div class="output"><pre class="knitr r">##  [1] &quot;X&quot;                    &quot;user_name&quot;            &quot;raw_timestamp_part_1&quot;
##  [4] &quot;raw_timestamp_part_2&quot; &quot;cvtd_timestamp&quot;       &quot;new_window&quot;          
##  [7] &quot;num_window&quot;           &quot;roll_belt&quot;            &quot;pitch_belt&quot;          
## [10] &quot;yaw_belt&quot;             &quot;total_accel_belt&quot;     &quot;gyros_belt_x&quot;        
## [13] &quot;gyros_belt_y&quot;         &quot;gyros_belt_z&quot;         &quot;accel_belt_x&quot;        
## [16] &quot;accel_belt_y&quot;         &quot;accel_belt_z&quot;         &quot;magnet_belt_x&quot;       
## [19] &quot;magnet_belt_y&quot;        &quot;magnet_belt_z&quot;        &quot;roll_arm&quot;            
## [22] &quot;pitch_arm&quot;            &quot;yaw_arm&quot;              &quot;total_accel_arm&quot;     
## [25] &quot;gyros_arm_x&quot;          &quot;gyros_arm_y&quot;          &quot;gyros_arm_z&quot;         
## [28] &quot;accel_arm_x&quot;          &quot;accel_arm_y&quot;          &quot;accel_arm_z&quot;         
## [31] &quot;magnet_arm_x&quot;         &quot;magnet_arm_y&quot;         &quot;magnet_arm_z&quot;        
## [34] &quot;roll_dumbbell&quot;        &quot;pitch_dumbbell&quot;       &quot;yaw_dumbbell&quot;        
## [37] &quot;total_accel_dumbbell&quot; &quot;gyros_dumbbell_x&quot;     &quot;gyros_dumbbell_y&quot;    
## [40] &quot;gyros_dumbbell_z&quot;     &quot;accel_dumbbell_x&quot;     &quot;accel_dumbbell_y&quot;    
## [43] &quot;accel_dumbbell_z&quot;     &quot;magnet_dumbbell_x&quot;    &quot;magnet_dumbbell_y&quot;   
## [46] &quot;magnet_dumbbell_z&quot;    &quot;roll_forearm&quot;         &quot;pitch_forearm&quot;       
## [49] &quot;yaw_forearm&quot;          &quot;total_accel_forearm&quot;  &quot;gyros_forearm_x&quot;     
## [52] &quot;gyros_forearm_y&quot;      &quot;gyros_forearm_z&quot;      &quot;accel_forearm_x&quot;     
## [55] &quot;accel_forearm_y&quot;      &quot;accel_forearm_z&quot;      &quot;magnet_forearm_x&quot;    
## [58] &quot;magnet_forearm_y&quot;     &quot;magnet_forearm_z&quot;     &quot;classe&quot;
</pre></div>
</div></div>

<p> 1.2. Verify which class the dataset variables belong to. As we'll see corresponding variables in the two dataseVAL are given a different class. </p>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">vartypeTR</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.character</span><span class="hl std">(</span><span class="hl kwd">lapply</span><span class="hl std">(TR,</span><span class="hl str">&quot;class&quot;</span><span class="hl std">))</span>  <span class="hl com"># provides an array of characters with the class for each variable</span>
<span class="hl std">vartypeVAL</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.character</span><span class="hl std">(</span><span class="hl kwd">lapply</span><span class="hl std">(VAL,</span><span class="hl str">&quot;class&quot;</span><span class="hl std">))</span>
<span class="hl std">coinc</span><span class="hl kwb">&lt;-</span><span class="hl std">vartypeTR</span><span class="hl opt">==</span><span class="hl std">vartypeVAL</span>  <span class="hl com"># This provides the variables that are the same</span>
<span class="hl std">vartypeTR[</span><span class="hl opt">!</span><span class="hl std">coinc]; vartypeVAL[</span><span class="hl opt">!</span><span class="hl std">coinc]</span> <span class="hl com"># See the class of the TR and VAL variables that do not coincide with Testing</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;factor&quot;
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;integer&quot; &quot;integer&quot; &quot;integer&quot; &quot;integer&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># And so we see that the VAL dataset has lots of logical variables that are considered numbers in the TR dataset</span>
<span class="hl kwd">names</span><span class="hl std">(VAL[,</span><span class="hl opt">!</span><span class="hl std">coinc]);</span> <span class="hl kwd">names</span><span class="hl std">(TR[,</span><span class="hl opt">!</span><span class="hl std">coinc])</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;magnet_dumbbell_z&quot; &quot;magnet_forearm_y&quot;  &quot;magnet_forearm_z&quot; 
## [4] &quot;problem_id&quot;
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;magnet_dumbbell_z&quot; &quot;magnet_forearm_y&quot;  &quot;magnet_forearm_z&quot; 
## [4] &quot;classe&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># So there are three variables that don't have the same class. We coerce the variables in TS to be the same type as TR. </span>
<span class="hl std">ind</span><span class="hl kwb">&lt;-</span><span class="hl kwd">seq</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl kwd">dim</span><span class="hl std">(TR)[</span><span class="hl num">2</span><span class="hl std">])[</span><span class="hl opt">!</span><span class="hl std">coinc]</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">3</span><span class="hl std">){</span>
  <span class="hl std">j</span><span class="hl kwb">&lt;-</span><span class="hl std">ind[i]; VAL[,j]</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.numeric</span><span class="hl std">(VAL[,j])</span>
<span class="hl std">}</span>
</pre></div>
</div></div>

<p> 1.3. It is worth noticing that the first sevel columns of both datasets are not needed. Remove them: </p>

<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">nvars</span><span class="hl kwb">&lt;-</span><span class="hl kwd">dim</span><span class="hl std">(TR)[</span><span class="hl num">2</span><span class="hl std">]</span>
<span class="hl std">TR</span><span class="hl kwb">&lt;-</span><span class="hl std">TR[,</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl std">nvars]; VAL</span><span class="hl kwb">&lt;-</span><span class="hl std">VAL[,</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl std">nvars]</span> <span class="hl com">#3</span>
<span class="hl std">varnames</span><span class="hl kwb">&lt;-</span><span class="hl std">varnames[</span><span class="hl num">8</span><span class="hl opt">:</span><span class="hl std">nvars]</span>
</pre></div>
</div></div>

<p> 1.4. We are left with 53 variables, but they are still too many. So we'll get rid of variables having little variance</p>

<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">varslowvar</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">nearZeroVar</span><span class="hl std">(TR,</span> <span class="hl kwc">saveMetrics</span> <span class="hl std">=</span> <span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl com"># The following command gives the number of variables with little variance</span>
<span class="hl kwd">sum</span><span class="hl std">(varslowvar</span><span class="hl opt">$</span><span class="hl std">zeroVar)</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># We cannot disregard any variables as none of them has little variance. Let's also see what variables are highly correlated</span>
<span class="hl std">CM</span><span class="hl kwb">&lt;-</span><span class="hl kwd">abs</span><span class="hl std">(</span><span class="hl kwd">cor</span><span class="hl std">(TR[,</span><span class="hl opt">-</span><span class="hl kwd">dim</span><span class="hl std">(TR)[</span><span class="hl num">2</span><span class="hl std">]]))</span>
<span class="hl com"># Remove the diagonal cause the correlation with itself is 1</span>
<span class="hl kwd">diag</span><span class="hl std">(CM)</span><span class="hl kwb">&lt;-</span><span class="hl num">0</span>
<span class="hl com"># Store the variables with correlation coeficient &gt;0.7 in a matrix</span>
<span class="hl std">correlated_vars</span><span class="hl kwb">&lt;-</span> <span class="hl kwd">which</span><span class="hl std">(CM</span><span class="hl opt">&gt;</span><span class="hl num">0.7</span><span class="hl std">,</span><span class="hl kwc">arr.ind</span><span class="hl std">=T)</span>
<span class="hl com"># The following plot will show the indecees of the highly correlated variables.</span>
<span class="hl kwd">plot</span><span class="hl std">(correlated_vars[,</span><span class="hl num">1</span><span class="hl std">],correlated_vars[,</span><span class="hl num">2</span><span class="hl std">])</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># And the number of correlations is:</span>
<span class="hl kwd">dim</span><span class="hl std">(correlated_vars)[</span><span class="hl num">1</span><span class="hl std">]</span><span class="hl opt">/</span><span class="hl num">2</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 38
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># So we can conclude that a Principal Component Analysis could help reducing the size of the dataset</span>
</pre></div>
</div></div>

<p>----------------------------------------------------------------------</p>
<H1> 2. Model fitting. </H1>
<p>Now it's time to fit a model and make a prediction of the outcome of the test dataset. Cross validation is required so we will run 10 iterations, splitting the TR set to 70%-30% (training/testing). For comparison purposes, we will use the Random Forest and the Boosted Predictor methods. </p>

<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># We'll apply this train control to fit three different models and illustrate how results may differ.</span>

<span class="hl com"># Model 1. Random Forest with principal components</span>
<span class="hl com"># ---------------------------------------------------------------------------------------</span>
<span class="hl com"># Datasets are preprocessed to perform a Principal Component Analysis</span>
<span class="hl std">pcs</span><span class="hl kwb">&lt;-</span><span class="hl kwd">prcomp</span><span class="hl std">(TR[,</span><span class="hl opt">-</span><span class="hl num">53</span><span class="hl std">]); spcs</span><span class="hl kwb">&lt;-</span><span class="hl kwd">summary</span><span class="hl std">(pcs)</span>
<span class="hl com"># Let's plot the Cumulative proportion of variance of the Principal to see how many of them we need to consider 95% of the variance</span>
<span class="hl kwd">plot</span><span class="hl std">(spcs</span><span class="hl opt">$</span><span class="hl std">importance[</span><span class="hl num">3</span><span class="hl std">,],</span><span class="hl kwc">xlab</span><span class="hl std">=</span><span class="hl str">'Variable index'</span><span class="hl std">,</span><span class="hl kwc">ylab</span><span class="hl std">=</span><span class="hl str">'Accumulated variance'</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl com"># From the cumulative proportion we can see that the first nine PCs account for more than 95% of the variance. Let's pre-process</span>
<span class="hl std">pr</span><span class="hl kwb">&lt;-</span><span class="hl kwd">preProcess</span><span class="hl std">(TR[,</span><span class="hl opt">-</span><span class="hl num">53</span><span class="hl std">],</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;pca&quot;</span><span class="hl std">,</span><span class="hl kwc">pcaComp</span><span class="hl std">=</span><span class="hl num">9</span><span class="hl std">)</span>
<span class="hl com"># now we transform the TR and VAL datasets into its principal components</span>
<span class="hl std">TRpc</span><span class="hl kwb">&lt;-</span><span class="hl kwd">predict</span><span class="hl std">(pr,TR[,</span><span class="hl opt">-</span><span class="hl num">53</span><span class="hl std">])</span>
<span class="hl std">VALpc</span><span class="hl kwb">&lt;-</span><span class="hl kwd">predict</span><span class="hl std">(pr,VAL[,</span><span class="hl opt">-</span><span class="hl num">53</span><span class="hl std">])</span>
<span class="hl com"># Fit the model</span>
<span class="hl std">RFmdl1</span><span class="hl kwb">&lt;-</span><span class="hl kwd">randomForest</span><span class="hl std">(TR</span><span class="hl opt">$</span><span class="hl std">classe</span><span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span> <span class="hl std">= TRpc)</span>

<span class="hl com"># Model 2. RF with the complete dataset TR </span>
<span class="hl com"># ---------------------------------------------------------------------------------------</span>
<span class="hl std">RFmdl2</span><span class="hl kwb">&lt;-</span><span class="hl kwd">randomForest</span><span class="hl std">(TR</span><span class="hl opt">$</span><span class="hl std">classe</span><span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span> <span class="hl std">= TR)</span>
<span class="hl com"># With this model we predict on the VAl dataset</span>

<span class="hl com"># Model 3. RF with cross validation and principal components</span>
<span class="hl com"># ---------------------------------------------------------------------------------------</span>
<span class="hl com"># Cross validation is established via train control</span>
<span class="hl std">TC</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">trainControl</span><span class="hl std">(</span><span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;cv&quot;</span><span class="hl std">,</span> <span class="hl kwc">number</span> <span class="hl std">=</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl kwc">verboseIter</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span> <span class="hl kwc">preProcOptions</span><span class="hl std">=</span><span class="hl str">&quot;pca&quot;</span><span class="hl std">,</span> <span class="hl kwc">allowParallel</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">RFmdl3</span><span class="hl kwb">&lt;-</span><span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span> <span class="hl std">= TR,</span> <span class="hl kwc">trControl</span><span class="hl std">=TC,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;rf&quot;</span><span class="hl std">)</span>  <span class="hl com"># Random Forest</span>
</pre></div>
</div></div>

<H> 3. Prediction </H>
<p> Finally ,we will use our models to predict the outcome for the VAL dataset and check the accuracy</p>

<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># And get the results</span>
<span class="hl std">rmdl1</span><span class="hl kwb">&lt;-</span><span class="hl kwd">predict</span><span class="hl std">(RFmdl1,VALpc); res</span><span class="hl kwb">&lt;-</span><span class="hl kwd">as.data.frame</span><span class="hl std">(rmdl1)</span>
<span class="hl std">res</span><span class="hl opt">$</span><span class="hl std">rmdl2</span><span class="hl kwb">&lt;-</span><span class="hl kwd">predict</span><span class="hl std">(RFmdl2,VAL)</span>
<span class="hl std">res</span><span class="hl opt">$</span><span class="hl std">rmdl3</span><span class="hl kwb">&lt;-</span><span class="hl kwd">predict</span><span class="hl std">(RFmdl3,VAL)</span>
<span class="hl kwd">print</span><span class="hl std">(res)</span>
</pre></div>
<div class="output"><pre class="knitr r">##    rmdl1 rmdl2 rmdl3
## 1      B     B     B
## 2      A     A     A
## 3      A     B     B
## 4      A     A     A
## 5      A     A     A
## 6      E     E     E
## 7      D     D     D
## 8      B     B     B
## 9      A     A     A
## 10     A     A     A
## 11     A     B     B
## 12     C     C     C
## 13     B     B     B
## 14     A     A     A
## 15     E     E     E
## 16     E     E     E
## 17     A     A     A
## 18     B     B     B
## 19     B     B     B
## 20     B     B     B
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Now check the accuracy of the results</span>
<span class="hl std">a1</span><span class="hl kwb">&lt;-</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">sum</span><span class="hl std">(RFmdl1</span><span class="hl opt">$</span><span class="hl std">confusion[,</span><span class="hl num">6</span><span class="hl std">])</span>
<span class="hl std">a2</span><span class="hl kwb">&lt;-</span><span class="hl num">1</span><span class="hl opt">-</span><span class="hl kwd">sum</span><span class="hl std">(RFmdl2</span><span class="hl opt">$</span><span class="hl std">confusion[,</span><span class="hl num">6</span><span class="hl std">])</span>
<span class="hl std">a3</span><span class="hl kwb">&lt;-</span><span class="hl kwd">max</span><span class="hl std">(RFmdl3</span><span class="hl opt">$</span><span class="hl std">results</span><span class="hl opt">$</span><span class="hl std">Accuracy)</span>

<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(a1,a2,a3))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 0.8142247 0.9845820 0.9949545
</pre></div>
</div></div>

<H> 4. Conclusions </H>

<p> The first model gives different results than the other two.
Based on the accuracy of the models, we would select the last model over the other two. </p>

H> 5. References </H>
<p>
1. "Human activity recognition" [link](http://groupware.les.inf.puc-rio.br/har)
2. "Qualitative activity recognition of weight lifting exercises" 
Velloso, Bulling, Gellersen, Ugulino, Fuks. 2013
[link](http://groupware.les.inf.puc-rio.br/work.jsf?p1=11201)
</p>

</body>
</html>
